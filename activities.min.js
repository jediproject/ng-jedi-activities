/*
 ng-jedi-activities v0.0.5
 Background tasks component written in angularjs
 https://github.com/jediproject/ng-jedi-activities
*/

!function(a){return"function"!=typeof define?("undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="jedi.activities"),a()):void define(["angular","moment","file-saver-saveas-js","angular-indexed-db","cryptojslib"],a)}(function(){"use strict";function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var b=[],c="hideMe",d="minimizeMe",e="activities";angular.module("jedi.activities",["indexedDB"]).config(["$indexedDBProvider",function(a){a.connection("activities").upgradeDatabase(1,function(a,b,c){b.createObjectStore(e,{keyPath:"id"})})}]),angular.module("jedi.activities").constant("jedi.activities.ActivitiesConfig",{inProgressWarning:"You will lost {{count}} activities. Would you like to continue?",i18nDirective:"",title:"Activities",minimizeLabel:"Minimize",closeLabel:"Close",successLabel:"Success",doneLabel:"Done",errorLabel:"Error",saveLabel:"Save",removeLabel:"Remove"}),angular.module("jedi.activities").service("jedi.activities.ActivitiesService",["$q","$http","$rootScope","$timeout","$indexedDB","$log",function(c,d,f,g,h,i){function j(a){h.openStore(e,function(b){b.insert({id:a.id,activityItem:a}).then(function(a){i.info("Inserindo atividade id: "+a)})})}this.initActivity=function(e,f,h,i,k,l,m){var n,o=moment.duration(),p=function(){o.add(1,"s"),q.duration="("+(o.hours()?o.hours()+":":"")+("0"+o.minutes()).slice(-2)+":"+("0"+o.seconds()).slice(-2)+")","progress"===q.status&&(n=g(p,1e3))},q={id:a(),name:k,status:"progress",duration:"(00:00)",userLoginHash:CryptoJS.MD5(l).toString()};b.push(q);var r={method:h.toUpperCase(),url:e+"/"+f,data:i,responseType:m?m:"arraybuffer",ignoreLoadingBar:!0,showLoadingModal:!1};g(p);var s=d(r).success(function(a,b,c,d){if("arraybuffer"===r.responseType.toLowerCase()||"blob"===r.responseType.toLowerCase()){var e=c("content-disposition"),f=e?e.substring(e.indexOf("filename=")+9):"";f&&(q.name=f),q.status="success",q.data=new Blob([a],{type:c("content-type")}),j(q)}else q.status="done",q.data=a,j(q)}).error(function(a,b){q.status="error",q.data=null,j(q)});return c.when(s.then(function(a){return{duration:o.asMilliseconds(),name:q.name,data:q.data,status:q.status}}))},this.clearActivities=function(){f.$broadcast("jedi.activities.clearActivities")},this.toggle=function(){f.$broadcast("jedi.activities.toggleMonitor")},this.validateActivities=function(a){f.$broadcast("jedi.activities.validateActivities",a)},this.hasInProgressActivities=function(){var a=0;return angular.forEach(b,function(b,c){"progress"===b.status&&a++}),a>0},this.hasActivities=function(){return b.length>0}}]).directive("jdActivity",["$log","$interpolate","jedi.activities.ActivitiesConfig",function(a,f,g){return{restrict:"E",replace:!0,link:function(a,e,h,i){a.$watch(function(){return b.length},function(a){if(a&&a>0){e.removeClass(c);var b=i.getInProgressItemsCount();b>0&&(e.removeClass(d),i.activitiesModel.minimize=!1)}else e.addClass(c)}),window.onbeforeunload=function(a){var b={count:i.getInProgressItemsCount()};return b.count>0?f(g.inProgressWarning)(b):void 0},a.$on("jedi.activities.clearActivities",i.clear),a.$on("jedi.activities.toggleMonitor",i.toggle),a.$on("jedi.activities.validateActivities",i.validateActivities)},controller:["$scope","$attrs","$element","$timeout","$log","$indexedDB","$rootScope",function(a,f,g,h,i,j,k){function l(){a.activityItems=b}function m(a){if("progress"==a.status)return!1;i.info("Removendo item "+a.name);var c=b.indexOf(a);b.splice(c,1),j.openStore(e,function(b){b["delete"](a.id)})}function n(){var a=0;return angular.forEach(b,function(b,c){"progress"===b.status&&a++}),a}function o(a){return"success"!=a.status?!1:(i.info("Salvando item "+a.name),void saveAs(a.data,a.name))}function p(){i.info("Atualizando lista de itens")}function q(){g.addClass(c)}function r(){return b&&b.length>0}function s(){i.info("Removendo lista de atividades");for(var a=b.length-1;a>=0;a--){var d=b[a].id;b.splice(a,1),j.openStore(e,function(a){a["delete"](d)})}g.addClass(c)}function t(){g.removeClass(c),g.removeClass(d)}function u(){g.hasClass(c)?t():q()}function v(a,c){j.openStore(e,function(a){a.getAll().then(function(d){angular.forEach(d,function(d){if(c){var e=CryptoJS.MD5(c.login).toString();if(d.activityItem.userLoginHash===e)return void b.push(d.activityItem)}a["delete"](d.id);for(var f=0;f<b.length;f++)b[f].id===d.id&&b.splice(f,1)})})})}i.info(b.length);var w=this;w.activitiesModel={minimize:!1},w.removeIconClick=m,w.saveIconClick=o,w.refresh=p,w.close=q,w.hasItemsToShow=r,w.clear=s,w.show=t,w.toggle=u,w.validateActivities=v,w.getInProgressItemsCount=n,l()}],controllerAs:"activitiesCtrl",bindToController:!0,templateUrl:function(a,b){return b.templateUrl?b.templateUrl:"assets/libs/ng-jedi-activities/activities.html"}}}]).run(["$templateCache","jedi.activities.ActivitiesConfig",function(a,b){var c='<div ng-class="{ minimizeMe: activitiesCtrl.activitiesModel.minimize }" class="animate-slide panel-default collapsable hideMe">    <div class="panel-heading activities-header">        <div class="row">            <div class="col-md-9 col-xs-9 col-sm-9 col-lg-9 pull-left activities-active" ng-click="activitiesCtrl.activitiesModel.minimize = !activitiesCtrl.activitiesModel.minimize">                <strong id="activitiesHeaderContent" class="activities-header-content">                    <i class="fa" ng-class="{ \'fa-spin\' : activitiesCtrl.activitiesModel.minimize && activitiesCtrl.getInProgressItemsCount() > 0, \'fa-cog\':  activitiesCtrl.activitiesModel.minimize && activitiesCtrl.getInProgressItemsCount() > 0, \'fa-tasks\': !activitiesCtrl.activitiesModel.minimize || (activitiesCtrl.activitiesModel.minimize && !activitiesCtrl.getInProgressItemsCount()) }"></i>                    <jd-i18n>                        '+b.title+'                    </jd-i18n>                </strong>            </div>            <div class="col-md-3 col-xs-3 col-sm-3 col-lg-3 text-right">                <span class="glyphicon activities-active glyphicon-minus" jd-i18n title="'+b.minimizeLabel+'" ng-click="activitiesCtrl.activitiesModel.minimize = !activitiesCtrl.activitiesModel.minimize"></span>&nbsp;                <span class="glyphicon activities-active glyphicon-remove" jd-i18n title="'+b.closeLabel+'" ng-click="activitiesCtrl.close()"></span>            </div>        </div>    </div>    <div class="panel-body activities-scroll">        <div ng-repeat="item in activityItems track by item.id">            <div class="row">                <div class="col-md-9 col-xs-9 col-sm-9 col-lg-9 activities-content">                    <span>{{item.name}} - {{item.duration}}</span>                </div>                <div class="col-md-3 col-xs-3 col-sm-3 col-lg-3 text-right">                    <span class="activities-progress" ng-if="item.status == \'progress\'"><i class="fa fa-cog fa-spin"></i></span>                    <span class="activities-done glyphicon glyphicon-ok" ng-if="item.status == \'success\'" jd-i18n title="'+b.successLabel+'"></span>                    <span class="activities-done glyphicon glyphicon-ok" ng-if="item.status == \'done\'" jd-i18n title="'+b.doneLabel+'"></span>                    <span class="activities-error glyphicon glyphicon-exclamation-sign" ng-if="item.status == \'error\'" jd-i18n title="'+b.errorLabel+'"></span>                    <span class="activities-inactive glyphicon glyphicon-save" ng-class="{\'activities-active\' : item.status == \'success\' }" jd-i18n title="'+b.saveLabel+'" ng-click="activitiesCtrl.saveIconClick(item)"></span>                    <span class="activities-inactive glyphicon glyphicon-remove" ng-class="{\'activities-active\' : item.status != \'progress\' }" jd-i18n title="'+b.removeLabel+'" ng-click="activitiesCtrl.removeIconClick(item)"></span>                </div>                <div class="col-md-1 col-xs-1 col-sm-1 col-lg-1">                </div>                <div class="col-md-1 col-xs-1 col-sm-1 col-lg-1">                </div>            </div>            <hr class="row activities-divider" />        </div>    </div></div>';b.i18nDirective&&(c=c.replace("jd-i18n",b.i18nDirective)),a.put("assets/libs/ng-jedi-activities/activities.html",c)}])});
//# sourceMappingURL=activities.min.map